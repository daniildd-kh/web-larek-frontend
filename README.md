# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Архитектура проекта 
  Проект реализует архитектурных подход MVP (Model-View-Presenter)
  * В роли моделей (Model - бизнес-логика) выступают классы : `Product`, `Basket`, `Catalog` и `Order`. Они находятся в файле AppData;
  * В роли представления (View) выступают классы `CardUI`, `CardPreviewUI`, `BasketUI`, `PageUI`, `OrderDeliveryUI`, `OrderContactFormUI`, `SuccessUI`
  * В роли же презентера (Presenter - посредника между Model и View) выступает файл index, связь создается через событийно-ориентированный подход.

## Базовый код 

# 1. Класс EventEmmiter
  Отвечает за работу с событиями. Позволяет подписываться и отписываться от событий, а также создавать события с передачей данных.
# 2. Класс Api
  Обеспечивает работу с HTTP-запросами. С его помощью можно создавать GET и POST запросы. Полученная информация обрабатывается в методе `handleResponse`, который возвращает данные в виде объекта.
# 3. Класс View 
  Является базовым для элементов отображения на странице. Принимает HTML-объект контейнера. Позволяет устанавливать текст и изображение, переключать классы, изменять видимость элементов, а также их блокировку. Метод `render` обеспечивает отрисовку данных в контейнере, и его можно использовать при инициализации или обновлении данных.
# 4. Класс Model 
  Базовый класс для моделей данных. Принимает данные шаблона и сохраняет их в экземпляре. Имеет метод `emitChanges`, который создает события и позволяет передавать в них данные.

## Общие компоненты

# 1. Класс Modal 
  Расширяет базовый класс `View` и отвечает за работу модального окна. Устанавливает переданные данные в свойство `content`, а также при инициализации создает слушателей для закрытия окна. 
  Метод `open` открывает модальное окно, добавляя соответствующий класс и отправляет событие `'modal:open'`. 
  Метод `close` закрывает модальное окно и создает событие `'modal:close'`. 
  Метод render используется для отображения контента и автоматически вызывает метод open.
# 2. Класс Form
  Как и предыдущий класс, Form расширяет базовый компонент `View`. Он представляет собой форму и обеспечивает работу с её состоянием, валидацией и отправкой данных. Класс прослушивает события ввода данных и отправки. 
  С помощью метода `onInputChange` создается событие `'change'`, в котором передаются название измененного поля и его значение. 
  Свойство `valid` устанавливает состояние доступности кнопки отправки формы, а свойство `error` обеспечивает вывод ошибок. 
  Метод `render` отвечает за отрисовку формы, включая её текущее состояние.
    
## Компоненты модели данных (бизнес-логика)

# 1. Класс Product
  Расширяет класс `Model`, обеспечивает хранение и представление данных.
  Интрефейс класса
  
    ``` 
    interface IProduct {
  	  id: string;
      title: string;
    	description: string;
    	image: string;
    	category: categoryOptions;
    	price: number;
      isAddedToBasket: boolean;
    }
    ```
# 2. Класс Basket 
  Расширяет класс `Model` со следующим интерфейсом:
  
  ```
    type IProductBasket = Pick<IProduct, 'id' | 'title' | 'price'>;
  ```

  Данные о продуктах корзины представлены в виде массива: `IProductBasket[]`
  
  Сам класс отвечает за работу с данными корзины, с его помощью можно:
  * Полностью очищать корзину с помощью метода `clearBasket`.
  * Удалять и добавлять товары с использованием методов `removeProduct` и `addProduct`.
  * Получать общую сумму товаров в корзине с помощью метода `getTotalAmount`.
  
  Получение данных о всех предматах в корзине осуществщяется методом `getProductList` он создает событие `'basket:change'` и передает в него массив данных
  При оформлении заказа срабатывает метод `makeOrder`, он осуществляется проверку товаров и создает событие `'basket:order'`

# 3. Класс Catalog
  Расширяет класс `Model` со следующим интерфейсом:
  
  ```
    IProduct[]
  ```

  Отвечает за работу с каталогом сайта. Хранит данные о продуктах в виде массива. 
  Инициализация происходит методом `setCatalog`, который принимает данные, обрабатывает их и отправляет событие `'catalog:updated'`.

# 4. Класс Order
  Расширяет класс `Model` со следующим интерфейсом:
  
  ```
  interface IOrderContact {
    phone: string;
    email: string;
}

  interface IOrderDelivery{
    address: string;
    payment: paymentOptions;
}

  interface IOrder extends IOrderContact, IOrderDelivery {
    total: number;
    items: string[];
}
  ```

  Этот класс управляет данными во время оформления заказа. Хранит информацию о способе доставки и адресе (первый блок), а также об электронной почте и номере телефона (второй блок). 
  Также содержит общую сумму заказа и `id` товаров из корзины. Все данные имеют значения по умолчанию.
  Содержит следующие методы для работы:
  Метод `setDeliveryField` принимает и устанавливает соответствующие значения в свойства (способ доставки и адрес). Он также осуществляет проверку данных с помощью метода `validateDelivery`. В случае успешной проверки метод создает событие `'order.delivery:ready'` и передает в него экземпляр класса.
  Метод `setContactField` выполняет аналогичную функцию, но работает с данными телефона и электронной почты, его проверку выполняет метод `validateContact`, который создает событие `'order.contact:ready'` и также передает туда экземпляр класса

## Компоненты представления

# 1. Класс CardUI
  Расширяет класс View со следующим интерфейсом:
  
  ```
  interface IProduct {
  	id: string;
    title: string;
  	description: string;
  	image: string;
  	category: categoryOptions;
  	price: number;
    isAddedToBasket: boolean;
  }
  ```

Этот класс предназначен для отображения информации о товарах на странице сайта. При инициализации принимает название блока (контейнера), сам контейнер и необязательный аргумент `action` для настройки действий. 
В конструкторе класса инициализируются следующие элементы: заголовок (`titleElement`), цена (`priceElement`), описание (`descriptionElement`), изображение (`imageElement`), категория (`categoryElement`) и кнопка (`buttonElement`). Также происходит проверка наличия объекта `action`: в случае его наличия создается событие на кнопке, в противном случае событие присваивается блоку. 
Через методы `set` и `get` в классе осуществляется установка контента внутри блока. 

# 2. Класс CardPreviewUI
  Расширяет класс `CardUI`

  Класс предназначен для отображения товара в модальном окне
  Он наследует все свойства и методы родителя, но изменяет метод `render` добавляя в него проверку на наличие в корзине `isAddedToBasket`, если товар там отсутствует, то будет кнопка будет "В корзину", иначе "Убрать из корзины"

# 3. Класс BasketUI
  Расширяет класс View со следующим интерфейсом:
  
  ```
  interface IBasketView{
    products: HTMLElement[];
    totalAmount: number;
  }
  ```

  Класс отвечает за отображение данных корзины. При объявлении принимает контейнер класса и `EventEmmiter`.
  Внутри конструктора объявляет: Список товаров (`listElement`), Общую сумму (`totalAmountElement`) и кнопку оформления (`buttonElement`), на кнопку сразу вешается слушатель, генерирующий событие `'order:open'` - переход в модальное окно с оформлением
  С помощью методов `set` устанавливается список товаров(`set products`) и их сумма (`set totalAmount`)

# 4. Класс PageUI
  Расширяет класс `View` со следующим интерфейсом:
  
  ```
  interface IPage{
    catalog: HTMLElement[];
    basketCounter: number;
    pageLock: boolean;
  }
  ```

  Класс отвечает за отображение и управление элементами страницы. Содержит методы для установки каталога продуктов, обновления счетчика корзины и блокировки страницы.
  Констурктор принимает аргументы самого контейнера и EvemtEmmiter
  Свойства реализующиеся внутри конструктора: Счетчик элементов в корзине(`basketCounterElement`), Кнопка для перехода в корзину(`basketButtonElement`), Каталог или же галерея товаров (`catalogElement`), Обертка страницы (`pageWrapperElement`)
  Кнопке сразу присваивается слушатель гененрирующий событие `''basket:open''` - открытие корзины с товарами
  Методы класса через `set` инициализируют каталог товаров (`set catalog`), и их число на корзине (`set busketNumber`), а через (`set pageLock`) происходит блокировка или разблокировка страницы.

# 5. Класс OrderDeliveryUI 
  Расширяет класс `Form`
  При создании экземпляра принимает в аргументы контейнер и `EvenEmmiter`, все это он передает в родителя `Form`. Через наследование свойств и методов родителя создается кнопка для отправки (`_submit`) и блок для вывода ошибок (`_errors`). На контейнер вешается событие, которое будет срабатывать при изменении любого поля формы. 
  Через метод `set address` устанавливает значение адреса в поле формы. Принимает строку `value` и устанавливает ее в качестве значения поля.
  То же самое делает метод `set payment`, но устанавливает значение для способа оплаты

# 6. Класс OrderContactFormUI
  Расширяет класс `Form`
  Прицип устройства такой же, что и у класса `OrderDeliveryUI`, но отвечает за заполнение номера телефона (` set phone`) и адреса электронной почты (`set email`)

# 7. Класс SuccessUI
  Расширяет класс `View` со следующим интерфейсом:
  
  ```
  interface ISuccess {
    totalAmount: number;
  }
  ```

  Его задача после оформления вывести окно об успешно пройденном заказе.
  При создании экземпляра принимает конструктор и действие `action` в качестве аргументов
  Внутри себя инициализирует одну кнопку `closeButton`, которая отвечает за закрытие модального окна и возврат обратно к каталогу товаров. 
  Имеет один метод `set totalAmount` для установки значения списанной суммы 
